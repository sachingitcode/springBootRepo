<v-app id="addApplication1ns">
    <v-form ref="form" v-model="valid" lazy-validation>
        <v-container fluid>
            <v-layout> 
                <v-flex xs12 sm12 md12 lg12 xl12 text-center>
                    <h1>INSTITUTE OF HOME ECONOMICS</h1>
                    <label>(UNIVERSITY OF DELHI)</label>
                </v-flex>
            </v-layout>
            <div data-th-replace="fragments/text-field :: input(label='Delhi University Enrolment No',model='userData.delhi_no',placeholder='',counter='',rules='[rules.required,rules.number,rules.length]',xs='12',sm='12',lg='6',xl='6')"></div>
            <v-layout> 
                <v-flex xs12 sm12 md12 lg12 xl12 text-center>
                    <h4><u>APPLICATION FORM FOR ADMISSION TO
                        </u>           
                    </h4>
                </v-flex>
            </v-layout>
            <v-layout text-center>
                <v-flex  xs12 sm3 md3 lg12 xl6></v-flex>
                <v-flex center xs12 sm12 md6 lg6 xl6>
                    <v-select   
                        :menu-props="{ maxHeight: '400' }"
                        :items="countryDataa"
                        item-text='name_course'
                        item-value='pk'
                        label='if issues earlier for any other course University of Delhi'
                        v-model="userData.cousre_sel" 
                        multiple
                        hint="Mark 1,2,3 in order of preference"
                        persistent-hint
                        ></v-select>
                </v-flex>
            </v-layout>
            <div data-th-replace="fragments/text-field :: input(label='Name(in capital letter)',model='userData.name',placeholder='',counter='',rules='[rules.required,rules.length]',xs='12',sm='12',lg='12',xl='12')"></div>
            <v-layout row wrap>
                <v-flex xs12 sm12 md4 lg4 xl6 >
                    <v-menu
                        v-model="menu9"
                        :close-on-content-click="false"
                        :nudge-right="40"
                        lazy
                        transition="scale-transition"
                        offset-y
                        full-width
                        min-width="290px"
                        >
                        <template v-slot:activator="{ on }">
                            <v-text-field
                                v-model="userData.Dob"
                                label="Date of Birth"
                                hint="(post holding at present)"
                                prepend-icon="event"
                                readonly
                                v-on="on"
                                ></v-text-field>
                        </template>
                        <v-date-picker @change="getAge" v-model="userData.Dob" @input="menu9 = false"></v-date-picker>
                    </v-menu>              
                    <v-spacer></v-spacer>
                </v-flex>
                <div data-th-replace="fragments/text-field :: input(label='Mobile No',model='userData.mobile',placeholder='',counter='10',rules='[rules.required,rules.number,rules.lengthp]',xs='12',sm='12',lg='4',xl='4')"></div>
                <div data-th-replace="fragments/text-field :: input(label='E-mail ID',model='userData.email',placeholder='',counter='',rules='[rules.required,rules.email]',xs='12',sm='12',lg='4',xl='4')"></div>          </v-layout>
            <v-layout row wrap>
                <div data-th-replace="fragments/text-field :: input(label='Age as on 1st Oct of the Current Year',model='userData.age',placeholder='',counter='10',rules='[rules.required,rules.number,rules.lengthp]',xs='12',sm='12',lg='4',xl='4')"></div>
                <div data-th-replace="fragments/text-field :: input(label='Months',model='userData.mont',placeholder='',counter='10',rules='[rules.required,rules.number,rules.lengthp]',xs='12',sm='12',lg='4',xl='4')"></div>
                <div data-th-replace="fragments/text-field :: input(label='Days',model='userData.day',placeholder='',counter='10',rules='[rules.required,rules.number,rules.lengthp]',xs='12',sm='12',lg='4',xl='4')"></div>    
            </v-layout>
            <v-layout>
                <div data-th-replace="fragments/text-field :: input(label='Fathers/Guardians Name',model='userData.fath',placeholder='',counter='50',rules='[rules.required,rules.lengthp]',xs='12',sm='12',lg='6',xl='6')"></div>
                <v-flex center xs12 sm12 md6 lg6 xl6>
                    <v-select   
                        :items="fatho"
                        item-text='fath_occ'
                        item-value='pk'
                        label='Occupation'
                        v-model="userData.occupation" 
                        ></v-select>
                </v-flex>
                <!--               
<v-flex>
                    <v-autocomplete v-model="userData.occupation"
                                    :loading="loading"
                                    :items="items"
                                    :search-input.sync="search"
                                    cache-items
                                    hide-no-data
                                    hide-details
                                    label="Occupation"></v-autocomplete>  
                </v-flex>-->

            </v-layout>
            <v-layout>

                <div data-th-replace="fragments/text-field :: input(label='Mobile No',model='userData.mobile2',placeholder='',counter='10',rules='[rules.required,rules.number,rules.lengthp]',xs='12',sm='12',lg='6',xl='6')"></div>
                <div data-th-replace="fragments/text-field :: input(label='E-mail ID',model='userData.email1',placeholder='',counter='',rules='[rules.required,rules.email]',xs='12',sm='12',lg='6',xl='6')"></div>
            </v-layout>
            <v-layout>
                <div data-th-replace="fragments/text-field :: input(label='Mothers Name',model='userData.moth',placeholder='',counter='50',rules='[rules.required,rules.length]',xs='12',sm='12',lg='6',xl='6')"></div>
                <v-flex center xs12 sm12 md6 lg6 xl6>
                    <v-select   
                        :items="motho"
                        item-text='moth_occ'
                        item-value='pk'
                        label='Occupation'
                        v-model="userData.occupation1" 
                        ></v-select>
                </v-flex>
            </v-layout>
            <v-layout>
                <div data-th-replace="fragments/text-field :: input(label='Mob No',model='userData.mobno',placeholder='',counter='10',rules='[rules.required,rules.number,rules.lengthp]',xs='12',sm='12',lg='6',xl='6')"></div>

                <div data-th-replace="fragments/text-field :: input(label='Nationality',model='userData.natio',placeholder='',counter='20',rules='[rules.required,rules.lengthp]',xs='12',sm='12',lg='6',xl='6')"></div>
            </v-layout>
            <div data-th-replace="fragments/text-field :: input(label='Present Address',model='userData.pre_add',placeholder='',counter='',rules='[rules.required,rules.length]',xs='12',sm='12',lg='12',xl='12')"></div>
            <v-layout>
                <div data-th-replace="fragments/text-field :: input(label='Mailing Address',model='userData.mail_add',placeholder='',counter='',rules='[rules.required,rules.length]',xs='12',sm='12',lg='6',xl='6')"></div>
                <div data-th-replace="fragments/text-field :: input(label='Emergency Contact No',model='userData.emer_cont',placeholder='',counter='',rules='[rules.required,rules.length,rules.number]',xs='12',sm='12',lg='6',xl='6')"></div>

            </v-layout>
            <v-layout>
                <div data-th-replace="fragments/text-field :: input(label='Tel No.(if any)',model='userData.tel_no',placeholder='',counter='10',rules='[rules.required,rules.length,rules.number]',xs='12',sm='12',lg='6',xl='6')"></div>
                <div data-th-replace="fragments/text-field :: input(label='E-mail',model='userData.email2',placeholder='',counter='',rules='[rules.required,rules.email]',xs='12',sm='12',lg='6',xl='6')"></div>
            </v-layout>


            <br>
            <br>

            <v-layout>
                <v-flex xs12 sm6 md6>
                    <br>
                    <h4>If Admission sought under any special category</h4>
                </v-flex>

                <v-flex xs12 sm6 md6>
                    <v-radio-group  v-model="userData.row8" row>

                        <v-radio label="Yes" value="true"></v-radio>
                        <v-radio label="No" value="false"></v-radio>

                    </v-radio-group>
                </v-flex>   
            </v-layout>

            <div v-if='userData.row8=="true"'>
                <h4>if yes. Please specify and attach a copy of documenter proof sought under any special category</h4>

                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>a)Scheduled Caste</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>
                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>b)Scheduled Tribe</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row1" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>

                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>c)OBC</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row2" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>

                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>d)Ward or Window of armed personnel killed/disabled  in action during hostilities</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row3" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>

                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>e)Physically Handicapped(HH/OH/PH)</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row4" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>

                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>f)Sports/ECA</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row5" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>

                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>g)Ward of Employees of University of Delhi</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row6" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>


                <v-layout>
                    <v-flex xs12 sm6 md6>
                        <br>
                        <h6>h)Foriegn Students</h6>
                    </v-flex>

                    <v-flex xs12 sm6 md6>
                        <v-radio-group v-model="userData.row7" row>

                            <v-radio label="Yes" value="radio-1"></v-radio>
                            <v-radio label="No" value="radio-2"></v-radio>

                        </v-radio-group>
                    </v-flex>   
                </v-layout>
            </div>

            <br>
            <br>
            <h3>Details of Senior Secondary or equivalent examination passed:</h3>


            <v-layout>
                <div data-th-replace="fragments/text-field :: input(label='Examiation ',model='userData.exm',placeholder='',counter='',rules='[rules.required,rules.length]',xs='12',sm='12',lg='6',xl='6')"></div>
                <div data-th-replace="fragments/text-field :: input(label='Board',model='userData.board',placeholder='',counter='',rules='[rules.required,rules.length]',xs='12',sm='12',lg='6',xl='6')"></div>

            </v-layout>
            <v-layout>

                <div data-th-replace="fragments/text-field :: input(label='Year of passing',model='userData.year_ofpass',placeholder='YYYY',counter='',rules='[rules.yearr,rules.yeard,rules.yeari,rules.number]',xs='12',sm='12',lg='6',xl='6')"></div>
                <div data-th-replace="fragments/text-field :: input(label='RollNo',model='userData.roll_no',placeholder='',counter='',rules='[rules.required,rules.length,rules.number]',xs='12',sm='12',lg='6',xl='6')"></div>


            </v-layout>


            <br>
            <br>
            <br>


            <v-layout>
                <v-form ref="form" v-model="valid" lazy-validation>
                    <v-flex xs12 sm12 md12 lg12 xl12>

                        <table class="table table-bordered" width="100%">
                            <thead>
                                <tr>
                                    <th width="20%">Sl.
                                        No</th>
                                    <th width="20%">Subject</th>
                                    <th width="20%">Max.Marks</th>
                                    <th width="20%">Marks Obtained</th>
                                    <th width="20%" >%</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(input, index) in userData.ref_course" :key="index">
                                    <td>
                                        {{index+1}}  
                                    </td>
                                    <td>
                            <v-text-field placeholder="Subject" v-model="input.sub_name" :rules="[rules.required,rules.length]"></v-text-field>
                            </td>
                            <td>
                            <v-text-field placeholder="Max.Marks" @change="maxmarks(index)" v-model="input.max_marks" :rules="[rules.required,rules.length,rules.number]"></v-text-field>
                            </td>
                            <td>
                            <v-text-field placeholder="Marks Obtained" @change="obtmarks(index);perc(index)" v-model="input.marks_obtai" :rules="[rules.required,rules.length,rules.number]"></v-text-field>
                            </td>

                            <td>
                                <br>   
                                <label >{{input.perc}}</label> 
                            </td>                         

                            </tr>


                            </tbody>
                        </table>
                        <v-btn icon color="green" @click="addRow">
                            <v-icon color="white">add</v-icon>
                        </v-btn>
                        <v-btn icon color="red" @click="deleteRow">
                            <v-icon color="white">remove</v-icon>
                        </v-btn>
                    </v-flex>

                    <br>


                </v-form>

            </v-layout>
            <v-layout>

                <div data-th-replace="fragments/text-field :: input(label='Total Marks Obtained',model='userData.total_mark',placeholder='YYYY',counter='',rules='[rules.required,rules.length,rules.number]',xs='12',sm='12',lg='6',xl='6')"></div>
                <div data-th-replace="fragments/text-field :: input(label='%/CGPA',model='userData.cgpa',placeholder='',counter='',rules='[rules.required,rules.length,rules.number]',xs='12',sm='12',lg='6',xl='6')"></div>
            </v-layout>


            <div th:replace="fragments/formelements.html :: footerbuttons(previous='', saveasDraft='saveasDraft',HandleSubmit='HandleSubmit')"></div>
        </v-container>
    </v-form>
</v-app>
<script th:inline="javascript">
    var myObject = new Vue({
        el: "#addApplication1ns",
        data: {loading: false,
            search: null,
            select: null,
            valid: true,
            menu9: false,
            currentId: /*[[${currentId}]]*/ '',
            nextId: /*[[${next}]]*/ '',
            prevId: /*[[${previous}]]*/ '',
            id: 0,
            tid: /*[[${tid}]]*/ '',
            countryData: [],
            countryDataa: [],
            fatho: [],
            motho: [],
            cat: false,
            userData: {
                name: '',
                delhi_no: '',
                doc_pk: '',
                Dob: '',
                mobile: '',
                email: '',
                age: '',
                mont: '',
                days: '',
                fath: '',
                mobile1: '',
                occupation: '',
                mobile2: '',
                mobno: '',
                email1: '',
                occupation1: '',
                natio: '',
                pre_add: '',
                mail_add: '',
                emer_cont: '',
                row: '',
                row1: '',
                row2: '',
                row3: '',
                row4: '',
                row5: '',
                row6: '',
                row7: '',
                tel_no: '',
                email2: '',
                exm: '',
                board: '',
                year_ofpass: '',
                roll_no: '',
                date_ofaward: '',
                cgpa: '',
                total_mark: '',
                moth: '',
                row8: "true",
                ref_course: [{
                        sub_name: '',
                        max_marks: '',
                        marks_obtai: '',
                        perc: ''

                    }],
            },
            rules: {
                required: v => !!v || 'Field is required',
                between: v => (v && v.length <= 50 && v.length >= 10) || 'Length must be between 10-50 characters',
                length: v => (v && v.length <= 50) || 'Name must be less than 50 characters',
                number: v => /^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$/.test(v) || 'Only Numbers',
                yeari: v => /^(19|20)\d{2}$/.test(v) || 'Invalid Year',
                yearr: v => !!v || 'Year is required',
                yeard: v => (v && v.length === 4) || 'Year must be 4 digits',
                email: v => /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(v) || 'E-mail must be valid',
                lengthp: v => (v && v.length <= 10) || 'Number must be 10 digits'
            },
        },
        watch: {
            search(val) {
                val && val !== this.select && this.querySelections(val)
            }

        },
        methods: {

            maxmarks(index) {


                var marks = this.userData.ref_course[index].max_marks;

                if (marks != '') {
                    if (marks > 100) {
                        alert("Sorry....................");
                        this.userData.ref_course[index].max_marks = '';
                    }
                }
            },
            obtmarks(index) {

                var obtmarks = this.userData.ref_course[index].marks_obtai;
                var maxmarks = this.userData.ref_course[index].max_marks;


                if (obtmarks != '') {
                    if (obtmarks > maxmarks) {
                        alert("Sorry....................");
                        this.userData.ref_course[index].marks_obtai = '';
                    }
                }
            },
            perc(index) {
                var maxmark = this.userData.ref_course[index].max_marks;
                var markobt = this.userData.ref_course[index].marks_obtai;

                var perc = (markobt / maxmark * 100).toFixed(2);
                this.userData.ref_course[index].perc = perc;



            },

            querySelections(v) {
                this.loading = true
                // Simulated ajax query
                setTimeout(() => {
                    this.items = this.occupation.filter(e => {
                        return (e || '').toLowerCase().indexOf((v || '').toLowerCase()) > -1
                    })
                    this.loading = false
                }, 500)
            },
            getCategory() {

                alert("dsd" + row8);




            },
            getAge() {
                var date = this.userData.Dob;
                if (date !== '') {
                    axios.get('/getAge?date=' + date)
                            .then(response => {
                                if (response.data != '') {
                                    var myAge = response.data.split('#');
                                    this.userData.age = myAge[0];
                                    this.userData.mont = myAge[1];
                                    this.userData.day = myAge[2];
                                }
                            })
                            .catch(e => {
                                alert("Error" + e);
                            })
                }
            },

            addRow() {
                this.userData.ref_course.push({
                    sub_name: '',
                    max_marks: '',
                    marks_obtai: '',
                    perc: '',
                })
            },
            deleteRow() {
                var myData = this.userData.ref_course;
                if (myData.length > 1) {
                    this.userData.ref_course.splice(-1, 1)
                }
            },
            checkData() {
                var message = '[[${next}]]';
                console.log('data==>>' + this.nextId);
                console.log('data==>>' + this.prevId);
            },
            validate() {
                if (this.$refs.form.validate()) {
                    this.snackbar = true
                }
            },
            saveasDraft() {
                var tid = removeQuot(this.tid);
                var currentId = removeQuot(this.currentId);
                var nextId = removeQuot(this.nextId);
                axios.post('/saveData',
                        {
                            "id": currentId,
                            "savedId": this.id,
                            "tid": this.tid,
                            "userData": this.userData
                        })
                        .then(response => {
                            alert("Response==>>" + response.data.id);
                    if (nextId !== null) {
                           loadForm("707902c6-4a21-11e9-aaf4-8c89a53bcce4", tid);
                            }
                        })
                        .catch(e => {
                            alert("Error");
                        })

            },
            reset() {
                this.$refs.form.reset()
            },
            HandleSubmit() {
                var tid = removeQuot(this.tid);
                var currentId = removeQuot(this.currentId);
                var nextId = removeQuot(this.nextId);
                axios.post('/saveData',
                        {
                            "id": currentId,
                            "savedId": this.id,
                            "tid": this.tid,
                            "userData": this.userData,
                            "nextId": nextId
                        })
                        .then(response => {
                          
                            if (nextId !== null) {
                                loadForm(nextId, response.data.id);
                            }
                        })
                        .catch(e => {
                            alert("Error");
                        })
            }
        },
        created() {
            var tid = removeQuot(this.tid);
            var currentId = removeQuot(this.currentId);
            axios.get('/findById?id=' + tid + "&pageid=" + currentId)
                    .then(response => {
                        if (response.data != '') {
                            this.userData = response.data.dt;
                            this.id = response.data.id;
                        }
                    })
                    .catch(e => {
                        alert("Error" + e);
                    })
                    
            axios.get('/docListing')
                    .then(response => {
                        if (response.data != '') {
                            this.countryData = response.data;
                        }
                    })
                    .catch(e => {
                        alert("Error" + e);
                    })

            //
            //            axios.get('/findByOcc')
            //                    .then(response => {
            //                        if (response.data != '') {
            //                            this.values = response.data;
            //                        }
            //                    })
            //                    .catch(e => {
            //                        alert("Error" + e);
            //                    })
            axios.get('/courseListing')
                    .then(response => {
                        if (response.data != '') {
                            this.countryDataa = response.data;
                        }
                    })
                    .catch(e => {
                        alert("Error" + e);
                    })
            axios.get('/fathList')
                    .then(response => {
                        if (response.data != '') {
                            this.fatho = response.data;
                        }
                    })
                    .catch(e => {
                        alert("Error" + e);
                    })
            axios.get('/mothList')
                    .then(response => {
                        if (response.data != '') {
                            this.motho = response.data;
                        }
                    })
                    .catch(e => {
                        alert("Error" + e);
                    })

        }

    })
</script>